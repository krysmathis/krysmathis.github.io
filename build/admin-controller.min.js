/*! krysmathis.github.io 2017-11-15 */

{const e=JSON.parse(localStorage.getItem("blog"))||{};e.blogEntries=e.blogEntries||[];let t=!1,o=null;const l=document.querySelector(".blogForm__headline"),n=document.querySelector(".blogForm__author"),s=document.querySelector(".blogForm__date"),a=document.querySelector(".blogForm__image"),c=document.querySelector(".blogForm__content"),r=document.querySelector(".blogForm__tags"),d=e=>{t=e;const o=document.querySelector(".messageBlock");e?(o.style.display="block",o.innerHTML="Edit Mode!"):o.style.display="none"},i=()=>{let t="";e.blogEntries.sort((e,t)=>t.dateAdded-e.dateAdded).forEach(e=>{t+=`\n\t\t\t\t<tr class="blogList__entry">\n\t\t\t\t\t<th class="blogList__headline">${e.headline}</th>\n\t\t\t\t\t<td class="blogList__preview">${e.content.substring(0,30).replace(/<(?:.|\n)*?>/gm,"")}</td>\n\t\t\t\t\t<td class="blogList__date">${e.dateAdded}</td>\n\t\t\t\t\t<td class="blogList__button-row"><button class="blogList__btn-edit" data-blog-id="${e.id}">Edit</button></td>\n\t\t\t\t</tr>\n\t\t\t\t`}),document.querySelector(".blogList__body").innerHTML=t};i();const u=function(){const u=r.value.split(", ");if(t){const t=e.blogEntries.findIndex(e=>e.id===o.id);e.blogEntries[t]=blogObjectFactory(l.value,s.value,n.value,a.value,c.value,u,o.id),i(),d(!1)}else{const t=blogObjectFactory(l.value,(new moment).format("YYYY-MM-DD"),n.value,a.value,c.value,u);e.blogEntries.unshift(t)}localStorage.setItem("blog",JSON.stringify(e))},g=t=>{o=e.blogEntries.find(function(e){return e.id===parseInt(t)})},b=()=>{r.value=o.tags.join(", "),l.value=o.headline,n.value=o.author,s.value=o.dateAdded,a.value=o.imgHeader,c.value=o.content,d(!0)},m=function(){const e=[];Array.from(document.querySelectorAll("input[class^='blogForm']")).forEach(t=>{0===t.value.length&&e.push({field:t.name,class:t.className,message:"missing "+t.name})});const t=document.querySelector("textarea[name='blog-content']").value;return t.length<3&&e.push({field:"blog-contents",class:t.className,message:"should contain at least 3 characters of content"}),e},_=function(e){let t="<h3>!!!Unacceptable Submission!!!</h3> <ul>";const o=document.querySelector(".messageBlock");e.forEach(e=>t+=`<li class="messageBlock__detail">Your ${e.field} is ${e.message}</li>`),t+="</ul>",o.style.display="block",o.style.backgroundColor="red",o.innerHTML=t},y=()=>{const e=document.querySelector(".messageBlock");e.style.backgroundColor="rgba(255,255,0,.75)",e.innerHTML="You've created a new blog!",e.style.display="block",setTimeout(function(){e.style.display="none"},1e4)};document.querySelector(".blogForm__btnGoToBlog").addEventListener("click",()=>{window.location.href="../blog/index.html"}),document.querySelector(".blogList__body").addEventListener("click",e=>{if("blogList__btn-edit"===e.target.className){const t=e.target.dataset.blogId;g(t),b()}}),document.querySelector(".blogForm__btnSave").addEventListener("click",()=>{const e=m();0===e.length?(u(),y(),i()):_(e)})}